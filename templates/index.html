<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>jQuery UI Tabs - Open on mouseover</title>
    <script src="static/jquery-3.2.1.min.js"></script>
    <script
      type="text/javascript"
      src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.5/socket.io.min.js"
    ></script>
    <script
      type="text/javascript"
      src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.5/socket.io.min.js"
    ></script>
    <script src="static/jquery-ui.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script>
      $(document).ready(function () {
        var x = new Array();
        var y = new Array();
        var z = new Array();
        var trace;
        var layout;
        namespace = "/test";
        var socket = io.connect(
          location.protocol +
            "//" +
            document.domain +
            ":" +
            location.port +
            namespace
        );

        socket.on("connect", function () {
          socket.emit("my_event", { data: "I'm connected!" });
        });

        socket.on("my_data", function (msg) {
          console.log(msg.data);
          $("#log")
            .append(
              "Data #" +
                msg.count +
                " Humidity: " +
                msg.humidity +
                " Temperature: " +
                msg.temperature +
                "<br>"
            )
            .html();
          x.push(parseFloat(msg.count));
          y.push(parseFloat(msg.humidity));
          z.push(parseFloat(msg.temperature));
          console.log(msg.humidity);
          trace = {
            x: x,
            y: y,
            name: "Humidity",
          };
          second_trace = {
            x: x,
            y: z,
            name: "Temperature",
          };
          layout = {
            title: "Data",
            xaxis: {
              title: "x",
            },
            yaxis: {
              title: "y",
              //range: [-1,1]
            },
          };
          console.log(trace);

          var traces = new Array();
          traces.push(trace, second_trace);
          Plotly.newPlot($("#plotdiv")[0], traces, layout);
          console.log(parseFloat(msg.humidity));
          var data = [
            {
              domain: { x: [0, 1], y: [0, 1] },
              value: parseFloat(msg.humidity),
              title: { text: "Speed" },
              type: "indicator",
              mode: "gauge+number",
              delta: { reference: 400 },
              gauge: { axis: { range: [-1, 1] } },
            },
          ];

          layout = { width: 600, height: 400 };
          Plotly.newPlot("myDiv", data, layout);
        });

        socket.on("my_response", function (msg) {
          console.log(msg.data);
          $("#log")
            .append(msg.data + "<br>")
            .html();
        });

        $("form#emit").submit(function (event) {
          socket.emit("my_event", { value: $("#emit_value").val() });
          return false;
        });
        $("form#disconnect").submit(function (event) {
          socket.emit("disconnect_request");
          return false;
        });
        $("#buttonVal").click(function (event) {
          console.log($("#buttonVal").val());
          socket.emit("click_event", { value: $("#buttonVal").val() });
          return false;
        });
        $("#start").click(function (event) {
          console.log($("#start").val());
          socket.emit("click_event", { value: $("#start").val() });
          return false;
        });
        $("#open").click(function (event) {
          console.log($("#open").val());
          socket.emit("initialize");
          return false;
        });
      });
    </script>
  </head>
  <body>
    <div id="tabs">
      <div id="tabs-1">
        <h1>Flask-SocketIO Test</h1>
        <h2>Send:</h2>
        <form id="emit" method="POST" action="#">
          <input
            type="text"
            name="emit_value"
            id="emit_value"
            placeholder="Amplituda"
          />
          <input type="submit" value="Send" />
        </form>
        <form id="disconnect" method="POST" action="#">
          <input type="submit" value="Disconnect" />
        </form>
        <h2>Receive:</h2>
        <div id="log"></div>
        <button id="start" type="submit" value="start">Start</button>
        <button id="open" type="submit" value="open">Open</button>
        <button id="buttonVal" type="submit" value="stop">Stop</button>
      </div>
      <div id="tabs-2">
        <div id="plotdiv" style="width: 600px; height: 250px"></div>
      </div>
      <div id="tabs-3">
        <div id="myDiv"></div>
      </div>
    </div>
  </body>
</html>
